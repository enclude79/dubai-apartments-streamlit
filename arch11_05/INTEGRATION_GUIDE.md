# Руководство по интеграции LangChain SQL с DeepSeek LLM

## Обзор

Мы интегрировали LangChain с нашей базой данных PostgreSQL, чтобы дать возможность модели DeepSeek LLM анализировать данные о недвижимости и генерировать ответы на естественном языке. Интеграция позволяет:

1. Генерировать SQL запросы к базе данных на основе вопросов пользователя
2. Выполнять запросы и получать результаты
3. Анализировать результаты и создавать ответы на русском языке

## Структура проекта

- `langchain_sql_integration.py` - Основной модуль интеграции
- `main.py` - Telegram бот с интегрированным LangChain SQL
- `test_final.py` - Тестовый скрипт для проверки функциональности
- `update_schema.py` - Скрипт для создания таблицы в базе данных
- `load_csv_full.py` - Скрипт для загрузки данных из CSV в базу данных

## Настройка

1. Установите необходимые библиотеки:
```bash
pip install langchain langchain-openai langchain-community langchain-sql python-dotenv psycopg2
```

2. Создайте файл `.env` с переменными окружения:
```
OPENROUTER_API_KEY=ваш_ключ_для_доступа_к_deepseek
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_CHANNEL_ID=идентификатор_канала
```

## Использование в коде

Пример использования `PropertyDatabaseAnalyzer`:

```python
from langchain_sql_integration import PropertyDatabaseAnalyzer

async def analyze_property_data(question):
    # Создание анализатора
    analyzer = PropertyDatabaseAnalyzer()
    
    # Получение ответа на вопрос
    answer = await analyzer.generate_property_analysis(question)
    
    return answer

# Пример вопроса
question = "Какой средний размер апартаментов с 2 спальнями в Downtown Dubai?"
answer = await analyze_property_data(question)
print(answer)
```

## Доступные вопросы

LangChain SQL может отвечать на различные вопросы о недвижимости, например:

- Сколько объектов недвижимости находится в стадии строительства?
- Какова средняя цена квартир с 3 спальнями в Dubai Marina?
- Какой застройщик построил больше всего объектов в Palm Jumeirah?
- В каком районе самые дорогие виллы?
- Как изменились цены на недвижимость за последний год?

## Типичный процесс обработки вопроса

1. Пользователь задает вопрос в Telegram
2. Telegram бот передает вопрос в модуль LangChain SQL
3. LangChain генерирует SQL запрос на основе вопроса
4. SQL запрос выполняется в базе данных
5. Результаты запроса анализируются DeepSeek LLM
6. DeepSeek LLM генерирует содержательный ответ на русском языке
7. Ответ отправляется пользователю

## Ограничения и рекомендации

- **Формат вопросов**: Вопросы должны быть четкими и конкретными для получения наиболее точных ответов
- **Ошибки SQL**: Система имеет механизм восстановления при неудачных SQL запросах
- **Производительность**: При большом количестве данных запросы могут выполняться дольше
- **Актуальность данных**: Для поддержания актуальности анализа регулярно обновляйте данные в базе

## Дальнейшее развитие

- Добавление возможности многошаговых диалогов с контекстом
- Интеграция с другими источниками данных
- Кэширование частых запросов для оптимизации производительности
- Расширение возможностей визуализации данных

## Контакты для вопросов

По вопросам работы с интеграцией обращайтесь к [имя_ответственного_разработчика]. 